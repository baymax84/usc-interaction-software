# <typical layout:>
#
# servo_controller:
#   path: "<device_path ie /dev/ttyUSB0>"
#   n_channels: <number_of_channels>
#   n_devices: <number_of_devices; opt>
#   n_channels_each: <number_of_channels_per_device; opt>
# #   - name: <joint_name>
#     device: <device_id>
#     channel: <channel_id>
#     enabled: <bool>
#     limits: [<lower_servo_limit>, <upper_servo_limit]
#     angle_limits[[<servo_value>, <lower_angle_limit>], [<servo_value>, <upper_angle_limit>]]
#   joint:
#     joint_angle_limits: [[<lower_joint_angle>, <servo_angle>], [<upper_joint_angle>, <servo_angle>]]
#     home: <joint_angle>

#     input_transfer_function: "..." // how does the servo affect some linear force-carrying element; must be exactly one built-in transfer function
#     output_transfer_function: "..." // how does some linear force-carrying element affect the joint; must be exactly one built-in transfer function
#     OR
#     transfer_function: "..."
#     inverse_transfer_function: "..."
#     OR
#     input_transfer_function: "..."
#     inverse_transfer_function

servo_controllers:
- path: "/dev/ttyACM0"
  n_channels: 24
  servos:
  - name: mouth
    device: 0
    channel: 0
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: head_nod
    device: 0
    channel: 1
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: head_turn
    device: 0
    channel: 2
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: r_arm_fwd
    device: 0
    channel: 3
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: r_arm_out
    device: 0
    channel: 4
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: r_elbow
    device: 0
    channel: 5
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: l_arm_fwd
    device: 0
    channel: 6
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: l_arm_out
    device: 0
    channel: 7
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: l_elbow
    device: 0
    channel: 8
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: r_wrist
    device: 0
    channel: 9
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: l_wrist
    device: 0
    channel: 10
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: body_fwd
    device: 0
    channel: 11
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: eyelids
    device: 0
    channel: 12
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: eyes
    device: 0
    channel: 13
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: r_foot_up
    device: 0
    channel: 14
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: r_foot_fwd
    device: 0
    channel: 15
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: l_foot_up
    device: 0
    channel: 16
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: l_foot_fwd
    device: 0
    channel: 17
    enabled: true
    limits: [900, 2100]
    angle_limits: [[1100, 0.0], [2100, 150.0]]
  - name: base_turn
    device: 0
    channel: 18
    enabled: true
    limits: [754, 2254]
    angle_limits: [[754, -335.0], [2254, 340.0]]
transfer_functions:
- name: servo_angle_to_cable_displacement
  parameters: [ "servo_angle", "servo_radius", "piston_length" ]
  definition: "( sqrt( var_piston_length^2 - ( var_servo_radius * cos( var_servo_angle ) )^2 ) + var_servo_radius * sin( var_servo_angle ) ) - sqrt( var_piston_length^2 - var_servo_radius^2 )"

- name: cable_displacement_to_servo_angle
  parameters: [ "cable_displacement", "servo_radius", "piston_length" ]
  definition: "acos( ( ( sqrt( var_piston_length^2 + var_servo_radius^2 ) + var_cable_displacement )^2 + var_servo_radius^2 - var_piston_length^2 ) / ( 2 * ( var_norm_piston_height + var_cable_displacement ) * var_servo_radius ) )"

- name: joint_angle_to_cable_displacement
  parameters: [ "joint_angle", "joint_radius", "joint_length" ]
  definition: "sqrt( var_joint_length^2 + var_joint_radius^2 - 2 * var_joint_length * var_joint_radius * cos( var_joint_angle ) ) - sqrt( var_joint_length^2 + var_joint_radius^2 )"

- name: cable_displacement_to_joint_angle
  parameters: [ "cable_displacement", "joint_radius", "joint_length" ]
  definition: "acos( ( var_joint_length^2 + var_joint_radius^2 - ( sqrt( var_joint_length^2 + var_joint_radius^2 ) + var_cable_displacement )^2 ) / ( 2 * var_joint_length * var_joint_radius ) )"
joints:
- name: mouth
  joint_limits: [[0.0, 150.0], [34.0, 80.0]]
  home: 34.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_radius: 2.2
- name: head_nod
  joint_limits: [[40.0, 150.0], [96.0, 51.0]]
  home: 90.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_radius: 1.4
- name: head_turn
  joint_limits: [[-35.0, 48.0], [38.0, 150.0]]
  home: 0.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_radius: 1.8
- name: r_arm_fwd
  joint_limits: [[12.0, 28.0], [96.0, 150.0]]
  home: 12.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_length: 6.3
  joint_radius: 1.8
  joint_offset: 50
  direction: -1.0
- name: r_arm_out
  joint_limits: [[15.0, 36.0], [91.0, 150.0]]
  home: 15.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_length: 2.8
  joint_radius: 1.8
  joint_offset: 55.0
- name: r_elbow
  joint_limits: [[12.0, 23.0], [105.0, 150.0]]
  home: 12.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_length: 3.7
  joint_radius: 1.8
  joint_offset: 25.0
- name: l_arm_fwd
  joint_limits: [[13.0, 24.0], [101.0, 150.0]]
  home: 13.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_length: 6.3
  joint_radius: 1.8
  joint_offset: 50
  direction: -1.0
- name: l_arm_out
  joint_limits: [[13.0, 22.0], [88.0, 150.0]]
  home: 13.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_length: 2.8
  joint_radius: 1.8
  joint_offset: 55.0
- name: l_elbow
  joint_limits: [[0.0, 22.0], [104.0, 150.0]]
  home: 0.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_length: 3.7
  joint_radius: 1.8
  joint_offset: 25.0
- name: r_wrist
  joint_limits: [[-86.0, 38.0], [55.0, 150.0]]
  home: 0.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_length: 3.9
  joint_radius: 1.0
- name: l_wrist
  joint_limits: [[-90.0, 28.0], [45.0, 150.0]]
  home: 0.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_length: 3.9
  joint_radius: 1.0
- name: body_fwd
  joint_limits: [[19.0, 30.0], [85.0, 150.0]]
  home: 19.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_radius: 2.0
- name: eyelids
  joint_limits: [[0.0, 150.0], [130.0, 62.0]]
  home: 30.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_radius: 0.7
- name: eyes
  joint_limits: [[-35.0, 46.0], [44.0, 150.0]]
  home: 0.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_radius: 2.0
- name: r_foot_up
  joint_limits: [[0.0, 10.0], [5.9, 122.0]]
  home: 0.0
  servo_radius: 4.5
  piston_length: 7.5
  joint_radius: 0.0
- name: r_foot_fwd
  joint_limits: [[-52.0, 150.0], [35.0, 18.0]]
  home: 0.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_radius: 1.6
- name: l_foot_up
  joint_limits: [[0.0, 10.0], [5.9, 122.0]]
  home: 0.0
  servo_radius: 4.0
  piston_length: 7.5
  joint_radius: 0.0
- name: l_foot_fwd
  joint_limits: [[-28.0, 24.0], [52.0, 150.0]]
  home: 0.0
  servo_radius: 1.7
  piston_length: 7.5
  joint_radius: 1.6
- name: base_turn
  joint_limits: [[-335.0, -335.0], [340.0, 340.0]]
  home: 0.0
  servo_radius: 0.0
  piston_length: 7.5
  joint_radius: 0.0
